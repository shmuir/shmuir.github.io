{
  "hash": "04a64bdf2bb806a355c59de9222627b7",
  "result": {
    "markdown": "---\ntitle: The Thomas Fire in Santa Barbara County 2017-2018\nsubtitle: Visualizing the burn area and change in air quality index\ndescription: 'This was an assignment for EDS220: Working with Environmental Datasets for the Masters of Environmental Data Science program at UCSB'\nauthor:\n  - name: Sam Muir\n    url: 'https://shmuir.github.io/'\n    orcid: null\n    affiliation: Bren School of Environmental Science & Management at University of California Santa Barbara\n    affiliation-url: 'https://bren.ucsb.edu/masters-programs/master-environmental-data-science'\ndate: 12-05-2023\ncategories:\n  - GIS\n  - MEDS\n  - Python\nbibliography: references.bib\ncitation:\n  url: 'https://shmuir.github.io/projects/2023-12-05-fire-aqi/'\ndraft: false\n---\n\nLink to project repository: <https://github.com/shmuir/california-fire-AQI>\n\n# Project Overview\n\nIn December of 2017 the Thomas Fire spread across Santa Barbara and Ventura counties in California, burning nearly 282,000 acres [@oakley2018]. It damaged many natural and developed areas and was spread rapidly by strong winds. Air quality during the time of the fire was quite bad and many schools cancelled classes due to the air quality concerns, along with the power outages.\n\n![](fire_haze.jpg){width=\"500\"}\n\nA photo taken along highway 101 showing burned palm trees and a hazy sky from fire smoke. This picture was taken December 13th, 2017 by me.\n\n## Highlights of Analysis\n\nIn this blog post I will be:\n\n-   Fetching and cleaning raster and tabular data\n\n-   Visualizing the extent of the burn areas from the Thomas Fire in Santa Barbara County in 2017\n\n-   Analyzing the change in air quality in Santa Barbara County across 2017-2018.\n\n# About the Data\n\n`ca_fires`: shapefile of fire perimeters in California for 2017\n\n`landsat`: simplified collection of bands (red, green, blue, near-infrared and shortwave infrared)\n\n`aqi_2017`: air quality index data from 2017\n\n`aqi_2018`: air quality index data from 2018\n\n## Data Sources\n\nThe Thomas fire shapefile was obtained from [California State Geoportal](https://gis.data.ca.gov/datasets/CALFIRE-Forestry::california-fire-perimeters-all-1/about).\n\nSanta Barbara landsat data was accessed and pre-processed in the Microsoft Planetary Computer to remove data outside land and coarsen the spatial resolution [(Landsat Collection in MPC)](https://planetarycomputer.microsoft.com/dataset/landsat-c2-l2).\n\nThe [Air Quality Index (AQI)](https://www.airnow.gov/aqi/aqi-basics/) was obtained from the [US Environmental Protection Agency](https://www.epa.gov/).\n\n# Reading in the Data\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\n# import libraries\nimport os\nimport numpy as np\nimport pandas as pd\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\nimport matplotlib.patches as mpatches # for creating legends\nimport matplotlib.lines as mlines\n\nimport xarray as xr\nimport rioxarray as rioxr\nfrom shapely.geometry import box\nfrom shapely.geometry import Point\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\n# california fires data\nca_fires = gpd.read_file(os.path.join(os.getcwd(), 'data', 'California_Fire_Perimeters_2017', 'California_Fire_Perimeters_2017.shp'))\n# landsat data\nlandsat = rioxr.open_rasterio(os.path.join(os.getcwd(),'data','landsat8-2018-01-26-sb-simplified.nc'))\n\n# air quality data\naqi_2017 = pd.read_csv(\"https://aqs.epa.gov/aqsweb/airdata/daily_aqi_by_county_2017.zip\")\naqi_2018 = pd.read_csv(\"https://aqs.epa.gov/aqsweb/airdata/daily_aqi_by_county_2018.zip\")\n```\n:::\n\n\n# Visualizing Thomas Fire Burn Area\n\nWe want to look at the extent of the Thomas Fire in Santa Barbara County. We will do this by plotting the false color imagery from the landsat data and adding the fire borders from the California fires data.\n\nFirst, we will need to prepare our data a bit more by\n\n-   dropping a dimension from the landsat data\n\n-   updating the coordinate references systems to match\n\n-   selecting data for only the Thomas Fire\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\n# drop 'band' from landsat data\nlandsat = landsat.squeeze()\nlandsat = landsat.drop('band')\n# update CRS of ca_fires to match the CRS of landsat\nca_fires = ca_fires.to_crs(landsat.rio.crs)\n# select only the thomas fire\nthomas_fire_border = ca_fires.loc[ca_fires.FIRE_NAME == \"THOMAS\"]\n```\n:::\n\n\nNow it's time to plot!\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(12,8)) # initialize plot\n\nax.axis(\"off\") # remove axis\n\nlandsat[['swir22', 'nir08', 'red']].to_array().plot.imshow(robust=True, ax= ax)\n\nthomas_fire_border.plot(ax=ax, color = 'red') # plot thomas fire ontop of landsat image\nfires_patch = mpatches.Patch(color='red', # change color to red\n                          label='Thomas Fire') # update label\n\nax.legend(handles = [fires_patch], frameon=False, loc = (0.75, 0.95), labelcolor = 'white') # add legend and update text color\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-5-output-1.png){width=723 height=631}\n:::\n:::\n\n\n# Air Quality Index Time Series\n\nNow that we have visualized the extent of the Thomas Fire in Santa Barbara County, we want to look at the change in air quality from before, during, and after the fire. The air quality index data is for all of the US, so we will need to select data for only Santa Barbara County. Additionally, we will calculate a 5 day rolling averge of the air quality index.\n\nAgain, we need to prepare the data before plotting. To do this, we will\n\n-   combine the 2017 and 2018 dataframes\n\n-   clean up the column names\n\n-   convert the date to a datetime object\n\n-   calculate 5 day rolling means\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\n# combine the two dataframes\naqi = pd.concat([aqi_2017,aqi_2018])\n# make the column names lower snake case\naqi.columns = aqi.columns.str.lower().str.replace(' ','_')\n# filter to only have SB county and drop other columns we don't need\naqi_sb = aqi[aqi['county_name'] == 'Santa Barbara'].drop(columns = ['state_name', 'county_name', 'state_code', 'county_code'])\n# make the date column a datetime instead of object data type\naqi_sb.date = pd.to_datetime(aqi_sb.date)\n# set the date to be the index\naqi_sb = aqi_sb.set_index('date')\n# calculate rolling 5D means of the aqi as a new column in the df\naqi_sb['five_day_average'] = aqi_sb.aqi.rolling('5D').mean()\n```\n:::\n\n\nNow we're ready to plot!\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\n# plot the results of rolling means and the raw aqi\naqi_sb.plot(y = ['aqi', 'five_day_average'],# both on same axis\n           kind = 'line', # line plot\n           ylabel = 'Air Quality Index', # update label\n            xlabel = '', # leave x-label blank\n            color = ['pink', 'grey'], # update to more visible colors\n           title = 'Air Quality Index in Santa Barbara County 2017-2018') # add a title\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\n<Axes: title={'center': 'Air Quality Index in Santa Barbara County 2017-2018'}, ylabel='Air Quality Index'>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-7-output-2.png){width=593 height=446}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}