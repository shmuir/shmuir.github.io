{
  "hash": "3876114a070d797124447fa1f4d81cb6",
  "result": {
    "markdown": "---\ntitle: \"Predicting plant species population trends from photosynthetic rate and ecological threats\"\n#subtitle: \"\"\ndescription: \"Created for EDS222: Statistics for Environmental Data Science for the Masters of Environmental Data Science program at UCSB\"\nauthor:\n  - name: Sam Muir\n    url: https://shmuir.github.io/\n  #  orcid: \n    affiliation: Bren School of Environmental Science & Management at University of California Santa Barbara\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science\ndate: 12-15-2023\ncategories: [Plants, Climate, R, MEDS]\nbibliography: references.bib\ncitation:\n  url: https://shmuir.github.io/projects/2023-12-15-plant-population-prediction/\n#image: map.png\nformat:\n  html:\n    code-fold: true\n---\n\n\n\n\n\n\n# Project Overview\n\n## Motivation\n\nClimate change and human activity are significant factors that threaten species populations. Nearly 40% of plant species are threatened worldwide, and even more are predicted to become threatened as effects of climate change and human activity continue. Many plant species that are threatened or endangered are not very resilient to conditions outside of their niche, often due to their physiological traits, such as carbon fixation.\n\nC4 and CAM plants have a more efficient carbon fixation process and are generally more photosynthetically-efficient than C3 processes. Plants with high photosynthetic efficiency are often economically important as crops and more resilient to harsh environments. Interestingly, cacti, which usually are CAM plants, are one of the most threatened groups of plants, despite their high photosynthetic efficiency.\n\nThere are many other factors that affect a species' population trend, but in this project, I am interested in using photosynthetic rates and ecological threats to try to predict a plant's population trend.\n\n# Data & Methods\n\nPhotosynthetic rate data was obtained from the `BIEN` R package. The Botanical Information and Ecology Network (BIEN) was developed by collaborating ecologists at the National Center for Ecological Analysis and Synthesis (NCEAS). The BIEN database contains a variety of information ranging from phylogeny data to species distribution. To determine population trend and if a species is threatened by climate change or human activity I obtained data from the IUCN Red List. Climate threats include habitat shifts, droughts, temperature extremes, storms & flooding, and other impacts not defined by the IUCN. Human threats include housing & urban areas, commercial & industrial areas, tourism & recreation areas, recreational activities, war & civil unrest, and work & other activities.\n\nTo analyze my data I ran a logistic regression model. I used Increasing/Stable (0) and Decreasing (1) as the categorical binary response variable on average photosynthetic rare per leaf area, climate threatened (yes/no), and human threatened (yes/no).\n\n## Data Preparation\n\nData was prepared in a separate `data_fetch.R` script. Data from `BIEN` was cleaned and joined with data from the IUCN Red List entries for species in the kingdom *Plantae*. Species that had an increasing or stable population trend were assigned a binary variable of 0 and those who had a decreasing population trend were assigned a binary variable of 1.\n\n```r \nsource(file.path(\"data_fetch.R\"))\n```\n\n\n::: {.cell}\n\n:::\n\n\n## Data Exploration\n\nBefore starting any statistical analysis, we should take a look at the data.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(join, aes(x = avg_photo)) +\n  geom_histogram(fill = \"#94a699\", color = \"black\") +\n  theme_linedraw() +\n  labs(x = \"Avg. Photosynthetic Rate per Leaf Area (Âµmol m-2 s-1)\",\n       title = \"Distribution of photosynthetic rate\") +\n  theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\"),\n        panel.background = element_rect(fill = \"#FDFBF7\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = join, aes(x = avg_photo, y = pop_trend)) + \n  geom_jitter(width = 0, height = 0.05, alpha = 0.7, color = \"#94a699\") +\n  theme_linedraw() +\n  scale_y_discrete(limits = c(\"Stable_Inc\", \"Decreasing\")) +\n  labs(x = \"Avg. Photosynthetic Rate per Leaf Area (Âµmol m-2 s-1)\", \n       y = \"Population Trend\", \n       title = \"\") +\n  theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\"),\n        panel.background = element_rect(fill = \"#FDFBF7\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nclim_plot <- ggplot(clim_human_res, aes(x = climate_threatened)) +\n  geom_bar(width = 0.5, fill = \"#94a699\", color = \"black\") +\n  theme_linedraw() +\n  labs(x = \"Climate threatened?\") +\n  theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\"),\n        panel.background = element_rect(fill = \"#FDFBF7\"))\n\nhuman_plot <- ggplot(clim_human_res, aes(x = human_threatened)) +\n  geom_bar(width = 0.5, fill = \"#94a699\", color = \"black\") +\n  theme_linedraw() +\n  labs(x = \"Human threatened?\", y = \"\") +\n  theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\"),\n        panel.background = element_rect(fill = \"#FDFBF7\"))\n\nclim_plot + human_plot + plot_annotation(theme = theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\")),\n                                       title = \"Counts for climate threatened and human threated species\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n# Analysis\n\n## Logistic Regression\n\nTo begin, I want to run a logistic regression on just photosynthetic rate and population trend before incorporating any other variables. \n\n##### $$\\operatorname{logit}(p)=\\log \\left(\\frac{p}{1-p}\\right)=\\beta_0+\\beta_1  (Photosynthetic Rate)  +\\varepsilon $$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# binary resp glm plot\nggplot(join, aes(x = avg_photo, y = pop_trend_binary)) + \n  geom_jitter(width = 0, height = 0.05, alpha = 0.8, color = \"#94a699\") +\n  geom_smooth(method = \"glm\", se = FALSE, color = \"#223a2b\", \n              method.args = list(family = \"binomial\"),\n              size = 1.5) +\n  theme_linedraw() +\n  labs(x = \"Avg. Photosynthetic Rate per Leaf Area (Âµmol m-2 s-1)\", \n       y = \"Has Decreasing Population Trend\") +\n  theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\"),\n        panel.background = element_rect(fill = \"#FDFBF7\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# model\nmod_photo <- glm(pop_trend_binary ~ avg_photo, \n                  data = join, \n                  family = \"binomial\") # binomial dist; prob of 1 and 0 over many trials\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Logisitc Regression Model Results for Photosynthetic Rate</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">log Probability of Decreasing Population</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Log-Odds</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p-value</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Intercept</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.464 <sup>**</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.907&nbsp;&ndash;&nbsp;-0.016</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>0.041</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Avg. Photosynthetic Rate (Âµmol m-2 s-1)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.089 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.133&nbsp;&ndash;&nbsp;-0.048</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">609</td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"font-style:italic; border-top:double black; text-align:right;\">* p&lt;0.1&nbsp;&nbsp;&nbsp;** p&lt;0.05&nbsp;&nbsp;&nbsp;*** p&lt;0.01</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\nThis model tells us:\n\nA 1 unit increase in photosynthetic rate indicates a 0.089 decrease in probability of having a decreasing population trend.\n\n$$\n\\operatorname{logit}(\\hat p)=\\log \\left(\\frac{\\hat p}{1-\\hat p}\\right)=-0.464-0.089 x\n$$\n\n### Odds Ratio\n\nBy how much does the model predict that the odds of having a decreasing population will change with each additional unit in photosynthetic rate?\n\n$$\n\\operatorname{odds}(\\hat{p})=\\frac{\\hat{p}}{1-\\hat{p}}=\\exp \\left(\\hat{\\beta}_0+\\hat{\\beta}_1 \\cdot x\\right)\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp(mod_photo$coefficients[2])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\navg_photo \n0.9146572 \n```\n:::\n:::\n\n\nThe model estimates that one additional unit in photosynthetic rate is associated with a change in the odds ratio of $e^{-0.089} = 0.915$, or a 8.9% decrease in the odds of having a decreasing population.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# compute odds hat var\nphoto_fitted <- mod_photo %>%\n  augment(type.predict = \"response\") %>%\n  mutate(y_hat = .fitted) %>%\n  mutate(odds_hat = y_hat / (1 - y_hat)) # y_hat is p\n\n# plot\nggplot(photo_fitted, aes(x = avg_photo, y = odds_hat)) +\n  geom_point(size = 2.5, color = \"#94a699\", alpha = 0.7) +\n  geom_line(color = \"#223a2b\") + \n  scale_y_continuous(\"Log-odds of having a decreasing population\") +\n  labs(x = \"Avg. Photosynthetic Rate (Âµmol m-2 s-1)\") +\n  theme_linedraw() +\n  theme(plot.background = element_rect(color = \"#FDFBF7\",\n                                       fill = \"#FDFBF7\"),\n        panel.background = element_rect(fill = \"#FDFBF7\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nAdditionally, we can visually see this relationship between the odds ratio and photosynthetic rate. As photosynthetic rate increases, the log-odds of having a decreasing population decreases. \n\n## Full Logistic Model\n\nThis first logistic model only considered photosynthetic rate, but now we want to add in if the species is threatened by climate change or human activity, since both of these historically have contributed to plant species becoming threatened.\n\n$$\\operatorname{logit}(p)=\\log \\left(\\frac{p}{1-p}\\right)=\\beta_0+\\beta_1  (Photosynthetic Rate) + \\beta_2  (Climate) + \\beta_3  (Human) +\\varepsilon $$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod <- glm(pop_trend_binary ~ avg_photo + climate_threatened + human_threatened,\n           data = clim_human_res,\n           family = \"binomial\")\n\nexp(coef(mod))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          (Intercept)             avg_photo climate_threatenedyes \n            0.6314813             0.8959289             4.2980568 \n  human_threatenedyes \n            2.5251016 \n```\n:::\n\n```{.r .cell-code}\nmod$coefficients[2] # B1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n avg_photo \n-0.1098942 \n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Logisitc Regression Model Results for Photosynthetic Rate, Climate Threatened, and Human Threatened</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"3\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">log Threat Pobability</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Log-Odds</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p-value</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Intercept</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.460 <sup>*</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.922&nbsp;&ndash;&nbsp;0.004</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.051</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Average Photosyntheitc Rate (Âµmol m-2 s-1)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.110 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.158&nbsp;&ndash;&nbsp;-0.065</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Climate Threatened</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">1.458 <sup>***</sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.665&nbsp;&ndash;&nbsp;2.237</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">Human Threatened</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.926 <sup></sup></td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.299&nbsp;&ndash;&nbsp;2.210</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.145</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"3\">609</td>\n</tr>\n<tr>\n<td colspan=\"4\" style=\"font-style:italic; border-top:double black; text-align:right;\">* p&lt;0.1&nbsp;&nbsp;&nbsp;** p&lt;0.05&nbsp;&nbsp;&nbsp;*** p&lt;0.01</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\nFrom this model we can conclude that plants threatened by climate factors have their odds of having a decreasing population increase by a factor of 4.29, while those threatened by human factors have their odds increase by a factor of 2.52. We can also see that photosynthetic rate does still have an effect on population trend. Based on this model, the odds of having a decreasing population trend fall by about 10% for each unit increase in photosynthetic rate. But, we can also see that the p-value for Human Threatened is >0.05, so it is not a significant factor in determining is a plant has a decreasing population. For this reason, it will not be included in the next section. \n\n# Making Probalistic Predictions\n\nThere are many species from the BIEN data that are not present on the IUCN Red List. Here, I am using my model to make out-of-sample predictions. To do this, I'll need to pull of the model coefficients and create a function with inputs for the coefficients, photosynthetic rate, if it is threatened by climate change, and if it is threatened by human activities.\n\n```r\nthreat_prob <- function(b0, b1, b2, photosyntheitc_rate, climate) {\n  equation <- b0 + b1 * photosyntheitc_rate + b2 * climate\n  prob <- (exp(equation)) / (1 + exp(equation))\n  print(prob)\n}\n```\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Predicted log-odds of being threatened (ˆy) for species with an unknown population trend</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Speices </th>\n   <th style=\"text-align:right;\"> Photosynthetic Rate </th>\n   <th style=\"text-align:right;\"> Climate </th>\n   <th style=\"text-align:right;\"> ˆy </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Psammochloa villosa </td>\n   <td style=\"text-align:right;\"> 65.05000 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0004961 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Helianthus neglectus </td>\n   <td style=\"text-align:right;\"> 48.72300 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0029764 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Helianthus niveus </td>\n   <td style=\"text-align:right;\"> 46.74867 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.0156898 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Glaux maritima </td>\n   <td style=\"text-align:right;\"> 43.00000 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.0235000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Helianthus cusickii </td>\n   <td style=\"text-align:right;\"> 42.24100 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0060494 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Gouania lupuloides </td>\n   <td style=\"text-align:right;\"> 0.70820 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.7151743 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Serjania mexicana </td>\n   <td style=\"text-align:right;\"> 0.68560 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.3693444 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Clematis florida </td>\n   <td style=\"text-align:right;\"> 0.61000 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.7173674 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Passiflora vitifolia </td>\n   <td style=\"text-align:right;\"> 0.51340 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0.7195148 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Cissus erosa </td>\n   <td style=\"text-align:right;\"> 0.43180 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.3758644 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n# Thoughts and Conclusions\n\n-   do these results support your hypothesis, why or why not\n-   discuss uncertainty (std error)\n-   discuss limitations\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/bsTable-3.3.7/bootstrapTable.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/bsTable-3.3.7/bootstrapTable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}